# Project Configuration & Environment Variables

## Overview

This document outlines all configuration required for ALMAYA Tourism Platform.

---

## Environment Variables Setup

### Backend Configuration (Railway)

Create these variables in Railway dashboard under your backend service:

```env
# Database Configuration
DATABASE_URL=mysql://username:password@host:port/almaya

# Authentication & Security
JWT_SECRET=your-64-character-random-jwt-secret-here
NODE_ENV=production

# Email Configuration (Gmail with 2-Factor Authentication)
EMAIL_SERVICE=gmail
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-16-character-app-password-from-gmail

# Application Configuration
RECIPIENT_EMAIL=your-email@gmail.com
FRONTEND_URL=https://your-vercel-project.vercel.app
PORT=3001
```

### Frontend Configuration (Vercel)

Create these variables in Vercel dashboard under your project settings:

```env
# API Configuration
REACT_APP_API_URL=https://your-railway-backend.up.railway.app

# Business Configuration
REACT_APP_WHATSAPP_NUMBER=212690002284
```

---

## Database Schema

The database is automatically initialized with:
- Users table (with role-based access)
- Categories table (tourism service types)
- Locations table (destinations)
- Offers table (tourism offers/experiences)
- Cart items table (user shopping carts)

**Schema File**: `/Database/almaya_complete.sql`

**Admin User (Default)**:
- Email: `admin@almaya.com`
- Role: `admin`
- Password: Change immediately in production!

---

## Credentials Generation

### JWT Secret (64+ Characters)

**Option 1: Using PowerShell**
```powershell
$jwt = [Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes(([Guid]::NewGuid().ToString() + [Guid]::NewGuid().ToString() + [Guid]::NewGuid().ToString() + [Guid]::NewGuid().ToString())))
Write-Host $jwt
```

**Option 2: Using Linux/Mac**
```bash
openssl rand -base64 64
```

**Option 3: Online Generator**
- Visit: https://generate-random.org/
- Set length to 64 characters
- Copy and paste

### Gmail App Password

**Requirements**:
- 2-Factor Authentication enabled on Gmail account
- App Password generated specifically for this application

**Steps**:
1. Login to Gmail
2. Go to https://myaccount.google.com/apppasswords
3. Select "Mail" and "Windows Computer" (or your device)
4. Google generates a 16-character password
5. Copy and save this password
6. **Use this password, NOT your Gmail password**

### Database Password

Database password is automatically generated by Railway. Use the `DATABASE_URL` provided.

---

## Deployment Platforms

### Railway (Backend + Database)

**Website**: https://railway.app

**What You Get**:
- Backend Node.js server hosting
- MySQL database
- Automatic SSL/HTTPS
- Logs and monitoring
- Free tier: $5/month credit

**Setup Time**: 10-15 minutes

**Monthly Cost**: Free (with $5 credit)

### Vercel (Frontend)

**Website**: https://vercel.com

**What You Get**:
- React frontend hosting
- Automatic SSL/HTTPS
- Global CDN
- Automatic deployments
- Logs and monitoring
- Unlimited free tier

**Setup Time**: 5-10 minutes

**Monthly Cost**: Free

---

## File Structure

```
Almaya/
├── backend/
│   ├── .env                    (Local development)
│   ├── .env.production         (Template for production)
│   ├── db.js                   (Database connection)
│   ├── server.js               (Express API server)
│   ├── package.json            (Dependencies)
│   └── railway.toml            (Railway deployment config)
│
├── frontend/
│   ├── .env.production         (Production config template)
│   ├── vercel.json             (Vercel deployment config)
│   ├── package.json            (Dependencies)
│   ├── public/                 (Static assets)
│   └── src/
│       ├── App.js              (Main routing)
│       ├── index.js            (Entry point)
│       ├── components/         (React components)
│       ├── contexts/           (Auth context)
│       └── Home.js             (Home page)
│
├── Database/
│   ├── almaya_complete.sql     (Full schema - use this)
│   ├── almaya.sql              (Alternative schema)
│   └── railway_setup.sql       (Railway-specific schema)
│
├── DEPLOYMENT.md               (Production deployment guide)
├── README.md                   (Project overview)
├── package.json                (Monorepo configuration)
└── nixpacks.toml               (Docker configuration)
```

---

## API Endpoints Reference

### Authentication

```
POST /api/register              Create new user account
POST /api/login                 Login user
POST /api/logout                Logout user
GET  /api/verify-email          Verify email address (from link)
POST /api/resend-verification   Resend verification email
GET  /api/profile               Get user profile (protected)
```

### Categories

```
GET  /api/categories            Get all categories
GET  /api/categories/:id        Get category details
POST /api/admin/categories      Create category (admin only)
PUT  /api/admin/categories/:id  Update category (admin only)
DELETE /api/admin/categories/:id Delete category (admin only)
```

### Locations

```
GET  /api/locations             Get all locations
GET  /api/locations/:slug       Get location details
POST /api/admin/locations       Create location (admin only)
PUT  /api/admin/locations/:slug Update location (admin only)
DELETE /api/admin/locations/:slug Delete location (admin only)
```

### Offers

```
GET  /api/categories/:id/offers Get offers by category
GET  /api/locations/:slug/offers Get offers by location
POST /api/admin/offers          Create offer (admin only)
PUT  /api/admin/offers/:id      Update offer (admin only)
DELETE /api/admin/offers/:id    Delete offer (admin only)
```

### Cart

```
GET  /api/cart                  Get user cart
PUT  /api/cart                  Update user cart
```

---

## Security Configuration

### Password Security
- **Algorithm**: BCrypt with 10 rounds
- **Storage**: Hashed, never plain text
- **Requirements**: Any length, special characters allowed

### JWT Tokens
- **Duration**: 1 hour expiration
- **Storage**: HttpOnly cookies (not localStorage)
- **HTTPS**: Required in production
- **Secret**: 64+ random characters

### Email Verification
- **Required**: Before login
- **Token**: 64-character random hex
- **Expiration**: None (single-use upon click)
- **Transport**: SMTP via Gmail

### Rate Limiting
- **Auth Endpoints**: 5 attempts per 15 minutes
- **Protection**: Brute force attack prevention
- **Error Message**: User-friendly (no IP leaking)

### CORS Configuration
- **Allowed Origin**: `FRONTEND_URL` environment variable
- **Credentials**: Allowed
- **Methods**: GET, POST, PUT, DELETE, OPTIONS
- **Headers**: Content-Type, Authorization

---

## Monitoring & Maintenance

### Logs Location

**Railway Backend Logs**:
- Railway Dashboard → Select Backend Service → Logs tab

**Vercel Frontend Logs**:
- Vercel Dashboard → Select Project → Deployments → Select Deployment → Logs

### Recommended Monitoring

- **Database**: Check size monthly (Railway: automatic backups)
- **API**: Monitor response times (Railway logs)
- **Frontend**: Check deployment status (Vercel logs)
- **Email**: Test verification monthly
- **Users**: Review for spam registrations

### Maintenance Tasks

- **Weekly**: Check logs for errors
- **Monthly**: Review database size and backups
- **Quarterly**: Update dependencies (`npm update`)
- **Yearly**: Security audit and penetration testing

---

## Troubleshooting Reference

### Common Issues & Solutions

| Issue | Cause | Solution |
|-------|-------|----------|
| CORS Error | Wrong FRONTEND_URL | Check Railway variable matches Vercel domain |
| Email Not Sending | Wrong Gmail password | Use app password, not regular Gmail password |
| Database Won't Connect | Wrong credentials | Verify DATABASE_URL in Railway |
| Frontend Won't Load | Wrong REACT_APP_API_URL | Check Vercel variable matches Railway URL |
| Can't Login | Account not verified | Check email for verification link |

---

## Deployment Checklist

- [ ] Environment variables set correctly
- [ ] Database initialized with schema
- [ ] Backend deployed on Railway (green status)
- [ ] Frontend deployed on Vercel (green status)
- [ ] Email verification tested
- [ ] User login tested
- [ ] Admin features tested (if applicable)
- [ ] API connectivity verified
- [ ] SSL/HTTPS working
- [ ] No console errors (F12 DevTools)

---

## Support Resources

**Documentation**:
- Railway: https://docs.railway.app
- Vercel: https://vercel.com/docs
- Node.js: https://nodejs.org/docs
- React: https://react.dev
- MySQL: https://dev.mysql.com/doc

**Community**:
- Railway Issues: https://railway.app/support
- Vercel Community: https://github.com/vercel/vercel/discussions
- Stack Overflow: Tag with `railway` or `vercel`

---

## Production Checklist

### Before Going Live

- [ ] All environment variables configured
- [ ] Database backups enabled (Railway: automatic)
- [ ] SSL certificates valid (automatic with Railway/Vercel)
- [ ] Email service working end-to-end
- [ ] No hardcoded credentials in code
- [ ] Error pages user-friendly
- [ ] Logging implemented for debugging
- [ ] Rate limiting prevents abuse
- [ ] Database passwords complex
- [ ] Admin password changed from default

### After Going Live

- [ ] Monitor logs for first 24 hours
- [ ] Test with real users
- [ ] Gather feedback
- [ ] Scale resources if needed (Railway/Vercel scales automatically)
- [ ] Document any issues and solutions
- [ ] Plan disaster recovery procedure

---

**For detailed deployment instructions, see**: [DEPLOYMENT.md](./DEPLOYMENT.md)

**Last Updated**: January 26, 2026  
**Status**: ✅ Production Ready
